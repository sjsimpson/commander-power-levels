---
import { type ContentEntryMap, getCollection } from "astro:content";
import LinkIcon from "astro-heroicons/solid/Link.astro";
import { cva } from "class-variance-authority";
import Footer from "./Footer.astro";
import CopyLinkButton from "./CopyLinkButton.astro";

interface Props {
	pageName: string;
	collectionName: keyof ContentEntryMap;
	nextPage?: { name: string; href: string };
	prevPage?: { name: string; href: string };
	leadText?: string;
}

const { pageName, collectionName, leadText, nextPage, prevPage } = Astro.props;

const collection = await getCollection(collectionName);
const parsedCollection = await Promise.all(
	collection
		.sort((a, b) => a.data.order - b.data.order)
		.map(async (item) => {
			const { Content } = await item.render();
			return { id: item.data.id, name: item.data.name, content: Content };
		}),
);

const proseStyles = cva(["prose prose-quoteless"]);
---

<article class={proseStyles()}>
	<h1 id="page-header">
		{pageName}
	</h1>
	{leadText && <p>{leadText}</p>}
	{
		parsedCollection.map((item) => (
			<section id={item.id} class="relative group">
				<div class="absolute w-10 h-full -left-10">
					<CopyLinkButton hash={`#${item.id}`} />
				</div>
				<h2>{item.name}</h2>
				<item.content />
			</section>
		))
	}
	<Footer nextPage={nextPage} prevPage={prevPage} />
</article>
